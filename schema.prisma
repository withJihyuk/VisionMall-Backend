generator client {
  provider  = "prisma-client-py"
  interface = "asyncio"
}

datasource db {
  provider = "postgresql"
  url      = env("DB_URL")
}

// 모델 정의
// TO-DO int autoincrement() 사용에 따른 유저 특정 가능 이슈 해결

model Users {
  id          Int      @id @default(autoincrement())
  sub         String   @unique
  email       String   @unique
  name        String
  picture     String
  zipCode     String?
  address     String?
  reviews     Reviews[]
  cart        Carts[]
  order       Orders[]
  login_at    DateTime @default(now())
  created_at  DateTime @default(now())
} // 나중에 주소를 별칭으로 관리 할 수 있도록 별도 테이블로 분리 가능

model RefreshTokens {
  id         String   @id
  token      String   @unique
  expires_at DateTime @default(dbgenerated("NOW() + INTERVAL '7 days'"))
} // 만료 시간 고려 필요

model Products {
  id        Int      @id @default(autoincrement())
  price     Int
  rating    Float
  title     String
  content   String
  status    ProductStatus
  cart      Carts[]
  order     Orders[]
  reviews   Reviews[]
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
} // 암시적 N:N 문제 해결 필요, 중간 테이블이 최선인듯

model Reviews {
  id        Int      @id @default(autoincrement())
  rating    Float
  content   String
  product   Products @relation(fields: [productId], references: [id])
  productId Int
  user      Users    @relation(fields: [userId], references: [id])
  userId    Int
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([userId, productId]) // 중복 리뷰 작성 방지 | orderId 기반으로 다시 리팩토링
}

model Orders {
  id        Int      @id @default(autoincrement())
  count     Int
  status    OrderStatus
  user      Users    @relation(fields: [userId], references: [id])
  userId    Int
  product   Products @relation(fields: [productId], references: [id])
  productId Int
  zipCode   String
  address   String
}

model Carts {
  user      Users      @relation(fields: [userId], references: [id])
  userId    Int        @id
  product   Products[]
  productId Int
}

// 타입 정의

enum ProductStatus {
  ON_SALE     // 판매중
  SOLD_OUT    // 매진
}

enum OrderStatus {
  PENDING         // 주문이 접수되었지만 아직 처리되지 않은 상태
  CONFIRMED       // 주문이 확인된 상태
  PROCESSING      // 주문이 처리 중인 상태 (예: 제품 준비 중)
  SHIPPED         // 주문이 발송된 상태
  DELIVERED       // 고객에게 배송이 완료된 상태
  CANCELED        // 주문이 취소된 상태
  RETURNED        // 주문이 반품된 상태
  REFUNDED        // 환불이 완료된 상태
}